<div class="parent-container">
  <div class="input-container" style="overflow: auto; max-height: 100vh;">
    <div class="timing-autorangebox">
      <div>
        <button class="timing" (click)="enableTiming()">Timing</button>
        <app-timing
          *ngIf="showTiming"
          [sweepTimingConfig]="sweepTimingConfig"
          (emitTimingData)="updateTimingConfig()"
          (ok)="closeTimingDialog()"
        ></app-timing>
      </div>
      <div>
        <button class="fetch-script" (click)="fetchScript()" >Fetch Script</button>
      </div>
    </div>

    <div class="expander">
      <div style="display: flex">
        <button (click)="toggleBias()" class="h3-button">
          <mat-icon>{{ isBiasExpanded ? "expand_more" : "chevron_right" }}</mat-icon>
        </button>
        <h3>Bias</h3>
      </div>
      <button class="button-icon" (click)="addBias()">
        <mat-icon>add</mat-icon>
      </button>
    </div>
    <div *ngIf="isBiasExpanded">
      <div *ngFor="let biasChannel of biasChannels; let i = index">
        <app-bias
          (focus)="setActiveComponent('bias', i)"
          (blur)="clearActiveComponent()"
          (emitBiasChannelData)="updateBiasChannelsConfig($event)"
          (emitBiasExpanderState)="handleBiasChanExpanderStateChange($event)"
          [biasChannel]="biasChannel"
          [isBiasChanExpanded]="
            isBiasChannelExpanded(biasChannel.common_chan_attributes.uuid)
          "
          [deviceList]="deviceList"
          (emitBiasChannelDelete)="removeBiasChannel($event)"
          (emitBiasChannelIdChange)="updateBiasChannelId($event)"
          [color]="getBiasColor(biasChannel)"
          [isActive]="activeComponent === 'bias' && activeIndex === i"
          (click)="setActiveComponent('bias', i); scrollToInstance('bias', i); scrollToPlotInPlotContainer('bias', i)"
        ></app-bias>
      </div>
    </div>

    <div class="expander">
      <div style="display: flex">
        <button (click)="toggleStep()" class="h3-button">
          <mat-icon>{{ isBiasExpanded ? "expand_more" : "chevron_right" }}</mat-icon>
        </button>
        <h3>Step</h3>
      </div>
    </div>
    <div *ngIf="isStepExpanded">
      <div *ngFor="let stepChannel of stepChannels; let i = index">
        <div>
          <app-step
            (emitStepData)="updateStepChannelsConfig($event)"
            (emitStepGlobalParameters)="updateStepGlobalParameters($event)"
            [stepChannel]="stepChannel"
            [stepGlobalParameters]="stepGlobalParameters"
            [deviceList]="deviceList"
            (emitStepChannelDelete)="removeStepChannel($event)"
            (emitStepChannelIdChange)="updateStepChannelId($event)"
            [color]="getStepColor(stepChannel)"
            [isActive]="activeComponent === 'step' && activeIndex === i"
            (click)="setActiveComponent('step', i); scrollToInstance('step', i); scrollToPlotInPlotContainer('step', i)"
          ></app-step>
        </div>
      </div>
    </div>

    <div class="expander">
      <div style="display: flex">
        <button (click)="toggleSweep()" class="h3-button">
          <mat-icon>{{ isBiasExpanded ? "expand_more" : "chevron_right" }}</mat-icon>
        </button>
        <h3>Sweep</h3>
      </div>
      <button class="button-icon" (click)="addSweep()">
        <mat-icon>add</mat-icon>
      </button>
    </div>
    <div *ngIf="isSweepExpanded">
      <div class="input-group">
        <div class="numeric-control">
          <app-input-numeric
            [(ngModel)]="sweepPoints.value"
            [label]="'Number of Points'"
            *ngIf="sweepPoints"
            name="sweepPoints"
          ></app-input-numeric>
        </div>
        <!-- <div>
        </div> -->
        <!-- <div class="checkbox">
          <label for="list">List</label>
          <input type="checkbox" id="list" [(ngModel)]="list" name="list" />
          <button class="timing">Edit</button>
        </div> -->
      </div>
      <div *ngFor="let sweepChannel of sweepChannels; let i = index">
        <div *ngIf="isSweepExpanded">
          <app-sweep
            (emitSweepData)="updateSweepChannelsConfig($event)"
            [sweepChannel]="sweepChannel"
            [deviceList]="deviceList"
            (emitSweepChannelDelete)="removeSweepChannel($event)"
            (emitSweepChannelIdChange)="updateSweepChannelId($event)"
            [color]="getSweepColor(sweepChannel)"
            [isActive]="activeComponent === 'sweep' && activeIndex === i"
            (click)="setActiveComponent('sweep', i); scrollToInstance('sweep', i); scrollToPlotInPlotContainer('sweep', i)"
          ></app-sweep>
        </div>
      </div>
    </div>
  </div>

  <div class="plot-container" style="overflow: auto; max-height: 100vh;">
    <app-plot-container
      [biasChannels]="biasChannels"
      [stepChannels]="stepChannels"
      [sweepChannels]="sweepChannels"
      [stepGlobalParameters]="stepGlobalParameters"
      [sweepGlobalParameters]="sweepGlobalParameters"
      [colorMap]="colorMap"
      [activeComponent]="activeComponent"
      [activeIndex]="activeIndex"
    ></app-plot-container>
  </div>
</div>
